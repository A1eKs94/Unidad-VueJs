<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie Details</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="movie.css" />
  </head>
  <body>
    <div id="app">
      <nav class="navbar">
        <div class="container">
          <a class="logo">Mi Aplicación</a>
          <ul class="menu">
            <li><a href="movies.html">Movies</a></li>
          </ul>
        </div>
      </nav>

      <fieldset>
        <div class="container">
          <div v-if="movie" class="movie-details">
            <div class="movie-content">
              <img :src="getImageUrl(movie.poster_path)" alt="Movie Poster" />
              <div class="movie-info">
                <h1>{{ movie.title }}</h1>
                <p>
                  <strong>Fecha de Lanzamiento:</strong> {{ movie.release_date
                  }}
                </p>
                <p>
                  <strong>Rating Global:</strong> {{
                  movie.vote_average.toFixed(1) }}
                </p>
                <p><strong>Descripción:</strong> {{ movie.overview }}</p>
                <div class="rating-section">
                  <h3>Tu Rating: {{ savedRating }}</h3>
                  <div>
                    <label
                      v-for="rate in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
                      :key="rate"
                    >
                      <input type="radio" v-model="userRating" :value="rate" />
                      {{ rate }}
                    </label>
                  </div>
                  <button class="button-19" @click="saveRating">
                    Guardar Rating
                  </button>
                  <button class="button-19" @click="removeRating">
                    Eliminar Rating
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div v-else>
            <p>Cargando detalles de la película...</p>
          </div>
        </div>
      </fieldset>
    </div>

    <script>
      const { createApp, ref, onMounted } = Vue;

      createApp({
        setup() {
          const movie = ref(null);
          const userRating = ref(null);
          const savedRating = ref(null);
          const apiKey = "YOUR_API_KEY_HERE";

          const getImageUrl = (path) => {
            return path
              ? `https://image.tmdb.org/t/p/w500${path}`
              : "https://via.placeholder.com/300";
          };

          const fetchMovieDetails = (id) => {
            const myHeaders = new Headers();
            myHeaders.append("Authorization", `Bearer ${apiKey}`);

            const requestOptions = {
              method: "GET",
              headers: myHeaders,
              redirect: "follow",
            };

            fetch(`https://api.themoviedb.org/3/movie/${id}`, requestOptions)
              .then((response) => response.json())
              .then((data) => {
                movie.value = data;
                loadSavedRating(id);
              })
              .catch((error) => console.error("Error:", error));
          };

          const saveRating = () => {
            if (movie.value) {
              const movieId = movie.value.id;
              localStorage.setItem(`rating_${movieId}`, userRating.value);
              savedRating.value = userRating.value;
            }
          };

          const removeRating = () => {
            if (movie.value) {
              const movieId = movie.value.id;
              localStorage.removeItem(`rating_${movieId}`);
              savedRating.value = null;
              userRating.value = null;
            }
          };

          const loadSavedRating = (id) => {
            const rating = localStorage.getItem(`rating_${id}`);
            if (rating) {
              savedRating.value = rating;
              userRating.value = rating;
            }
          };

          onMounted(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get("id");
            if (movieId) {
              fetchMovieDetails(movieId);
            }
          });

          return {
            movie,
            getImageUrl,
            userRating,
            saveRating,
            removeRating,
            savedRating,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
